# 配电网潮流计算与优化分析系统

本项目旨在对配电网进行全面的潮流计算、结果可视化以及 SVG（静止无功发生器）容量的优化配置。项目包含从源数据清洗、标准化处理到最终潮流计算及优化的全流程脚本。

## 项目结构

```text
duaochaoliu/
├── data/                   # 数据存放目录
│   ├── 01_源数据/          # 原始负荷与支路参数CSV文件
│   ├── 02_中间数据/        # 数据处理过程中的中间文件
│   ├── 03_标准化数据/      # 供Pandapower使用的标准化输入文件
│   ├── 04_潮流计算结果/    # 潮流计算输出的Excel结果
│   ├── 05_可视化结果/      # 电压曲线等可视化图表
│   └── ...
├── scripts/                # 核心处理脚本
│   ├── 01_有功整理.py
│   ├── 02_节点无功处理.py
│   ├── 03_有功累加.py
│   ├── 04_标准化.py
│   ├── 05_潮流计算.py
│   ├── 06_结果可视化.py
│   ├── 09_SVG容量优化_OPF.py
│   └── 10_优化配置潮流计算.py
├── main.py                 # 全流程运行入口（数据处理 -> 潮流计算 -> 可视化）
├── 潮流计算及结果可视化.py   # 仅运行计算与可视化入口
├── find_hydro_nodes.py     # 辅助工具：查找小水电节点（负值负荷）
└── README.md               # 项目说明文档
```

## 快速开始

### 1. 环境准备

确保已安装 Python 及以下依赖库：

- pandas
- numpy
- pandapower
- matplotlib
- openpyxl

### 2. 运行全流程

如果需要从原始数据开始处理，请运行 `main.py`：

```bash
python main.py
```

该脚本将按顺序执行 `scripts/` 目录下的 01 至 06 号脚本。

### 3. 仅运行计算与可视化

如果数据已处理完毕，仅需重新计算潮流或生成图表，请运行：

```bash
python 潮流计算及结果可视化.py
```

## 脚本详细说明

### 数据处理阶段

#### 1. `scripts/01_有功整理.py`

- **功能**: 读取 `data/01_源数据` 下的公有/专有变压器负荷数据。
- **处理**: 清洗用户编号，提取日期前缀，将分散的CSV数据整理为统一格式。
- **输出**: `data/02_中间数据/有功负荷整理`

#### 2. `scripts/02_节点无功处理.py`

- **功能**: 根据有功功率和功率因数计算无功功率。
- **逻辑**: 公式：$Q = P \times \tan(\arccos(PF))$。
- **输出**: `data/02_中间数据/无功负荷整理`

#### 3. `scripts/03_有功累加.py`

- **功能**: 对处理后的负荷数据进行汇总和格式调整。
- **处理**: 处理节点偏移量（Node 1 预留给平衡节点），填充缺失序号。
- **输出**: `data/02_中间数据/负荷整理`

#### 4. `scripts/04_标准化.py`

- **功能**: 将支路参数和负荷数据转换为 Pandapower 可识别的标准格式。
- **处理**:
  - 映射列名（如 `电阻_R` -> `r_ohm`）。
  - 确保数值类型正确。
  - 生成标准化的支路参数表和各时间点的负荷数据表。
- **输出**: `data/03_标准化数据`

### 仿真计算阶段

#### 5. `scripts/05_潮流计算.py`

- **功能**: 基于标准化数据建立电网模型并进行潮流计算。
- **核心**: 使用 `pandapower` 库。
- **步骤**:
  - 读取支路数据创建节点和线路。
  - 读取负荷数据，在对应节点加载 P/Q 负荷。
  - 运行牛顿-拉夫逊法（Newton-Raphson）进行潮流计算。
- **输出**: `data/04_潮流计算结果`（包含各节点电压、线路负载率等）

#### 6. `scripts/06_结果可视化.py`

- **功能**: 将潮流计算结果绘制成图表。
- **图表**: 节点电压分布曲线等。
- **风格**: 采用科研绘图风格（Science Style），支持中英文标签。
- **输出**: `data/05_可视化结果`

### 优化配置阶段

#### 7. `scripts/09_SVG容量优化_OPF.py`

- **功能**: 使用最优潮流（OPF）算法确定 SVG 的最优安装位置和容量。
- **目标**: 将节点电压维持在安全范围内（如 0.93 - 1.07 p.u.）。
- **输出**: 优化后的 SVG 配置方案。

#### 8. `scripts/10_优化配置潮流计算.py`

- **功能**: 在加入优化配置的 SVG 后，再次进行潮流计算以验证效果。
- **输出**: `data/06_优化后潮流计算`

## 辅助工具

- **`find_hydro_nodes.py` / `find_hydro_nodes_v2.py`**:
  扫描标准化负荷数据，查找有功功率为负值的节点，用于识别系统中的分布式电源（如小水电）。

## 测试脚本

- **`check_env.py`**: 检查 Python 环境及 Pandapower 库是否安装正确。
- **`test_opf.py`**: 使用简单的 4 节点系统测试最优潮流（OPF）求解器是否正常工作。

## 注意事项

- 脚本中涉及的路径均为相对路径，建议在项目根目录下运行脚本。

